<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test TALON Slim Select</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Slim Select CSS -->
    <link rel="stylesheet" href="https://unpkg.com/slim-select@latest/dist/slimselect.css">
    
    <!-- TALON Slim Select CSS -->
    <link rel="stylesheet" href="../css/components/slim-searchable-select.css">
    
    <style>
        .test-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-container">
            <h1 class="text-center mb-4">Test TALON Slim Select</h1>
            
            <!-- Test 1: Select Semplice -->
            <div class="test-section">
                <h3>Test 1: Select Semplice</h3>
                <div class="form-group">
                    <label for="test-select-1">Seleziona Opzione:</label>
                    <div data-select-id="test-select-1"></div>
                    <select id="test-select-1" style="display: none;">
                        <option value="" disabled selected>-- Seleziona opzione --</option>
                        <option value="option1">Opzione 1</option>
                        <option value="option2">Opzione 2</option>
                        <option value="option3">Opzione 3</option>
                        <option value="option4">Opzione 4</option>
                    </select>
                </div>
                <button type="button" class="btn btn-primary mt-2" onclick="testGetValue('test-select-1')">
                    Ottieni Valore
                </button>
                <div id="result-1" class="mt-2 alert alert-info" style="display: none;"></div>
            </div>
            
            <!-- Test 2: Select con Gruppi -->
            <div class="test-section">
                <h3>Test 2: Select con Gruppi (Enti Militari)</h3>
                <div class="form-group">
                    <label for="test-select-2">Seleziona Ente Militare:</label>
                    <div data-select-id="test-select-2"></div>
                    <select id="test-select-2" style="display: none;">
                        <option value="" disabled selected>-- Seleziona ente militare --</option>
                        <optgroup label="ESERCITO ITALIANO">
                            <option value="ei_1" data-details="Roma - Via Po, 14" data-tooltip="Comando Generale Esercito">
                                COMANDO GENERALE ESERCITO
                            </option>
                            <option value="ei_2" data-details="Torino - Corso Francia, 23" data-tooltip="Comando Militare Nord">
                                COMANDO MILITARE NORD
                            </option>
                        </optgroup>
                        <optgroup label="AERONAUTICA MILITARE">
                            <option value="am_1" data-details="Roma - Viale dell'Università, 4" data-tooltip="Stato Maggiore Aeronautica">
                                STATO MAGGIORE AERONAUTICA
                            </option>
                            <option value="am_2" data-details="Milano - Via Manzoni, 12" data-tooltip="Comando Aeronautica Nord">
                                COMANDO AERONAUTICA NORD
                            </option>
                        </optgroup>
                        <optgroup label="MARINA MILITARE">
                            <option value="mm_1" data-details="La Spezia - Viale Amendola, 1" data-tooltip="Comando Marittimo Nord">
                                COMANDO MARITTIMO NORD
                            </option>
                            <option value="mm_2" data-details="Napoli - Via Acton, 2" data-tooltip="Comando Marittimo Sud">
                                COMANDO MARITTIMO SUD
                            </option>
                        </optgroup>
                    </select>
                </div>
                <button type="button" class="btn btn-primary mt-2" onclick="testGetValue('test-select-2')">
                    Ottieni Valore
                </button>
                <div id="result-2" class="mt-2 alert alert-info" style="display: none;"></div>
            </div>
            
            <!-- Test 3: Multi Select -->
            <div class="test-section">
                <h3>Test 3: Multi Select</h3>
                <div class="form-group">
                    <label for="test-select-3">Seleziona Multiple Opzioni:</label>
                    <div data-select-id="test-select-3"></div>
                    <select id="test-select-3" multiple style="display: none;">
                        <option value="multi1">Prima Opzione</option>
                        <option value="multi2">Seconda Opzione</option>
                        <option value="multi3">Terza Opzione</option>
                        <option value="multi4">Quarta Opzione</option>
                        <option value="multi5">Quinta Opzione</option>
                    </select>
                </div>
                <button type="button" class="btn btn-primary mt-2" onclick="testGetValue('test-select-3')">
                    Ottieni Valori
                </button>
                <div id="result-3" class="mt-2 alert alert-info" style="display: none;"></div>
            </div>
            
            <!-- Test Controls -->
            <div class="test-section">
                <h3>Controlli Test</h3>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-success" onclick="testAllSelects()">
                        Test Tutti
                    </button>
                    <button type="button" class="btn btn-warning" onclick="refreshAllSelects()">
                        Refresh Tutti
                    </button>
                    <button type="button" class="btn btn-danger" onclick="destroyAllSelects()">
                        Distruggi Tutti
                    </button>
                    <button type="button" class="btn btn-info" onclick="reinitializeAllSelects()">
                        Reinizializza Tutti
                    </button>
                </div>
            </div>
            
            <!-- Log Area -->
            <div class="test-section">
                <h3>Log Console</h3>
                <div id="log-area" class="bg-dark text-light p-3 rounded" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.8rem;">
                    <!-- Log messages will appear here -->
                </div>
                <button type="button" class="btn btn-secondary mt-2" onclick="clearLog()">
                    Pulisci Log
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Slim Select JS -->
    <script src="https://unpkg.com/slim-select@latest/dist/slimselect.min.js"></script>
    
    <!-- TALON Slim Select JS -->
    <script src="slim-searchable-select.js"></script>
    
    <!-- Test Script -->
    <script>
        // Override console.log per mostrare nel log area
        const originalConsoleLog = console.log;
        const logArea = document.getElementById('log-area');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #28a745;">[${new Date().toLocaleTimeString()}]</span> ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        };
        
        // Override console.error per mostrare nel log area
        const originalConsoleError = console.error;
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #dc3545;">[ERROR ${new Date().toLocaleTimeString()}]</span> ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        };
        
        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== TALON SLIM SELECT TEST STARTED ===');
            
            setTimeout(function() {
                // Test configurazioni personalizzate
                if (window.TalonSlimSelect) {
                    console.log('TalonSlimSelect disponibile, configurazione test...');
                    
                    // Test 1: Select semplice
                    const select1 = document.querySelector('[data-select-id="test-select-1"]');
                    if (select1) {
                        TalonSlimSelect.create(select1, {
                            settings: {
                                placeholderText: 'Seleziona una opzione...',
                                searchPlaceholder: 'Cerca opzione...',
                                searchText: 'Nessuna opzione trovata'
                            },
                            events: {
                                afterChange: function(newVal) {
                                    console.log('Test 1 - Valore cambiato:', newVal);
                                }
                            }
                        });
                        console.log('Test 1 inizializzato');
                    }
                    
                    // Test 2: Select con gruppi
                    const select2 = document.querySelector('[data-select-id="test-select-2"]');
                    if (select2) {
                        TalonSlimSelect.create(select2, {
                            settings: {
                                placeholderText: 'Seleziona ente militare...',
                                searchPlaceholder: 'Cerca per nome, codice o città...',
                                searchText: 'Nessun ente trovato',
                                showOptionTooltips: true,
                                searchHighlight: true
                            },
                            events: {
                                afterChange: function(newVal) {
                                    console.log('Test 2 - Ente selezionato:', newVal);
                                }
                            },
                            talon: {
                                logEvents: true,
                                enableTooltips: true
                            }
                        });
                        console.log('Test 2 inizializzato con tooltips');
                    }
                    
                    // Test 3: Multi select
                    const select3 = document.querySelector('[data-select-id="test-select-3"]');
                    if (select3) {
                        TalonSlimSelect.create(select3, {
                            settings: {
                                placeholderText: 'Seleziona multiple opzioni...',
                                maxSelected: 1000,
                                maxValuesMessage: '{number} opzioni selezionate'
                            },
                            events: {
                                afterChange: function(newVal) {
                                    console.log('Test 3 - Multi selezione:', newVal);
                                }
                            }
                        });
                        console.log('Test 3 multi-select inizializzato');
                    }
                    
                    console.log('Tutti i test inizializzati correttamente!');
                } else {
                    console.error('TalonSlimSelect non disponibile!');
                }
            }, 300);
        });
        
        // Funzioni di test
        function testGetValue(selectId) {
            const instance = window.TalonSlimSelect.get(selectId);
            const resultDiv = document.getElementById('result-' + selectId.split('-')[2]);
            
            if (instance) {
                const value = instance.getValue();
                console.log(`Valore ${selectId}:`, value);
                resultDiv.innerHTML = `<strong>Valore:</strong> ${JSON.stringify(value, null, 2)}`;
                resultDiv.style.display = 'block';
            } else {
                console.error(`Istanza non trovata per ${selectId}`);
                resultDiv.innerHTML = `<strong>Errore:</strong> Istanza non trovata`;
                resultDiv.className = 'mt-2 alert alert-danger';
                resultDiv.style.display = 'block';
            }
        }
        
        function testAllSelects() {
            console.log('=== TEST TUTTI I SELECT ===');
            ['test-select-1', 'test-select-2', 'test-select-3'].forEach(selectId => {
                testGetValue(selectId);
            });
        }
        
        function refreshAllSelects() {
            console.log('=== REFRESH TUTTI I SELECT ===');
            window.TalonSlimSelect.refresh();
            console.log('Refresh completato');
        }
        
        function destroyAllSelects() {
            console.log('=== DISTRUGGI TUTTI I SELECT ===');
            window.TalonSlimSelect.destroyAll();
            console.log('Tutti i select distrutti');
        }
        
        function reinitializeAllSelects() {
            console.log('=== REINIZIALIZZA TUTTI I SELECT ===');
            window.TalonSlimSelect.reinitialize();
            console.log('Reinizializzazione completata');
        }
        
        function clearLog() {
            document.getElementById('log-area').innerHTML = '';
            console.log('Log pulito');
        }
    </script>
</body>
</html>