<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Test SPA Navigation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-passed {
            background: #d4edda;
            color: #155724;
        }
        .test-failed {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test SPA Navigation System</h1>
        
        <div class="test-section" id="test-spa-loaded">
            <h3>1. Verifica caricamento SPA Navigation</h3>
            <p>Status: <span id="spa-status">Checking...</span></p>
        </div>
        
        <div class="test-section" id="test-fullscreen-loaded">
            <h3>2. Verifica caricamento Fullscreen Manager</h3>
            <p>Status: <span id="fullscreen-status">Checking...</span></p>
        </div>
        
        <div class="test-section">
            <h3>3. Test Funzionalit√†</h3>
            <button onclick="testFullscreen()">Test Fullscreen</button>
            <button onclick="testSPANavigation()">Test SPA Navigation</button>
            <button onclick="checkConsole()">Controlla Console</button>
        </div>
        
        <div class="test-section">
            <h3>4. Console Output</h3>
            <div class="console-output" id="console-output">
                Waiting for tests...
            </div>
        </div>
        
        <div class="test-section">
            <h3>5. Test Links (come sidebar)</h3>
            <p>Questi link dovrebbero usare SPA navigation:</p>
            <a href="/dashboard">Dashboard</a> |
            <a href="/dashboard_admin">Dashboard Admin</a> |
            <a href="/impostazioni">Impostazioni</a>
        </div>
    </div>

    <script>
        // Log custom per debug
        const logOutput = document.getElementById('console-output');
        function customLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#0ff';
            logOutput.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(message);
        }

        // Test 1: Verifica caricamento SPA
        window.addEventListener('DOMContentLoaded', function() {
            customLog('DOM Loaded - Starting tests...', 'info');
            
            // Check SPA Navigation
            const spaStatus = document.getElementById('spa-status');
            const spaSection = document.getElementById('test-spa-loaded');
            
            if (typeof window.TalonSPA !== 'undefined') {
                spaStatus.textContent = '‚úÖ SPA Navigation caricato correttamente';
                spaStatus.style.color = 'green';
                spaSection.classList.add('test-passed');
                customLog('‚úÖ TalonSPA found: ' + JSON.stringify(Object.keys(window.TalonSPA)), 'success');
            } else {
                spaStatus.textContent = '‚ùå SPA Navigation NON caricato';
                spaStatus.style.color = 'red';
                spaSection.classList.add('test-failed');
                customLog('‚ùå TalonSPA NOT found!', 'error');
                customLog('Assicurati che spa-navigation.js sia incluso in _base.html', 'error');
            }
            
            // Check Fullscreen Manager
            const fullscreenStatus = document.getElementById('fullscreen-status');
            const fullscreenSection = document.getElementById('test-fullscreen-loaded');
            
            if (typeof window.TalonFullscreen !== 'undefined') {
                fullscreenStatus.textContent = '‚úÖ Fullscreen Manager caricato correttamente';
                fullscreenStatus.style.color = 'green';
                fullscreenSection.classList.add('test-passed');
                customLog('‚úÖ TalonFullscreen found: ' + JSON.stringify(Object.keys(window.TalonFullscreen)), 'success');
            } else {
                fullscreenStatus.textContent = '‚ùå Fullscreen Manager NON caricato';
                fullscreenStatus.style.color = 'red';
                fullscreenSection.classList.add('test-failed');
                customLog('‚ùå TalonFullscreen NOT found!', 'error');
                customLog('Assicurati che fullscreen-manager.js sia incluso in _base.html', 'error');
            }
            
            // Check TALON_CONFIG
            if (typeof window.TALON_CONFIG !== 'undefined') {
                customLog('‚úÖ TALON_CONFIG found', 'success');
                customLog('User logged in: ' + window.TALON_CONFIG.user.isLoggedIn, 'info');
            } else {
                customLog('‚ö†Ô∏è TALON_CONFIG not found', 'error');
            }
            
            // Intercetta click sui link per debug
            document.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', function(e) {
                    customLog(`Link clicked: ${this.href}`, 'info');
                    
                    if (window.TalonSPA && window.TalonSPA.shouldInterceptLink) {
                        if (window.TalonSPA.shouldInterceptLink(this)) {
                            customLog('‚úÖ Link will be intercepted by SPA', 'success');
                        } else {
                            customLog('‚ö†Ô∏è Link will NOT be intercepted', 'error');
                        }
                    }
                });
            });
        });
        
        // Test Fullscreen
        function testFullscreen() {
            customLog('Testing fullscreen...', 'info');
            
            if (window.TalonFullscreen) {
                window.TalonFullscreen.toggle();
                customLog('Fullscreen toggled', 'success');
            } else {
                customLog('TalonFullscreen not available!', 'error');
            }
        }
        
        // Test SPA Navigation
        function testSPANavigation() {
            customLog('Testing SPA Navigation...', 'info');
            
            if (window.TalonSPA) {
                customLog('SPA enabled: ' + window.TalonSPA.enabled, 'info');
                customLog('Current URL: ' + window.TalonSPA.currentUrl, 'info');
                
                // Test navigate
                customLog('Attempting to navigate to /dashboard via SPA...', 'info');
                window.TalonSPA.navigate('/dashboard', 'Dashboard Test');
            } else {
                customLog('TalonSPA not available!', 'error');
            }
        }
        
        // Check Console
        function checkConsole() {
            customLog('=== Console Check ===', 'info');
            customLog('window.TalonSPA: ' + (typeof window.TalonSPA), 'info');
            customLog('window.TalonFullscreen: ' + (typeof window.TalonFullscreen), 'info');
            customLog('window.TALON_CONFIG: ' + (typeof window.TALON_CONFIG), 'info');
            
            // Check if jQuery is loaded
            customLog('jQuery loaded: ' + (typeof jQuery !== 'undefined'), 'info');
            
            // Check Bootstrap
            customLog('Bootstrap loaded: ' + (typeof bootstrap !== 'undefined'), 'info');
            
            // List all global TALON objects
            const talonObjects = Object.keys(window).filter(key => key.includes('Talon') || key.includes('TALON'));
            customLog('TALON objects found: ' + JSON.stringify(talonObjects), 'info');
        }
        
        // Listen for SPA events
        document.addEventListener('spa:navigation-complete', function(e) {
            customLog('üéâ SPA Navigation Complete: ' + e.detail.url, 'success');
        });
        
        document.addEventListener('spa:content-loaded', function() {
            customLog('üéâ SPA Content Loaded', 'success');
        });
    </script>
</body>
</html>